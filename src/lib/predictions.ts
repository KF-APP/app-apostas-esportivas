export type RiskLevel = 'conservative' | 'medium' | 'high';
export type BetType = 'total_goals' | 'both_teams_score' | 'corners' | 'match_winner' | 'correct_score';

export interface BetSuggestion {\n  id: string;\n  fixtureId?: number;\n  type: BetType;\n  riskLevel: RiskLevel;\n  description: string;\n  odds?: number;\n  confidence: number; // 0-100\n  reasoning: string;\n  prediction: string;\n}\n\nexport interface MatchAnalysis {\n  fixtureId: number;\n  homeTeam: {\n    name: string;\n    form: string;\n    goalsScored: number;\n    goalsConceded: number;\n    avgGoalsScored: number;\n    avgGoalsConceded: number;\n  };\n  awayTeam: {\n    name: string;\n    form: string;\n    goalsScored: number;\n    goalsConceded: number;\n    avgGoalsScored: number;\n    avgGoalsConceded: number;\n  };\n  h2h: {\n    totalMatches: number;\n    homeWins: number;\n    awayWins: number;\n    draws: number;\n    avgGoals: number;\n  };\n}\n\nexport interface PredictionResult {\n  fixtureId: number;\n  suggestions: BetSuggestion[];\n  status: 'pending' | 'won' | 'lost' | 'void';\n  result?: {\n    homeGoals: number;\n    awayGoals: number;\n    corners?: number;\n  };\n  date: string;\n}\n\n/**\n * Gera sugestões de apostas baseadas em estatísticas reais e odds\n * IMPORTANTE: Não usa API OpenAI - apenas análise estatística\n */\nexport function generateBetSuggestions(analysis: MatchAnalysis): BetSuggestion[] {\n  const suggestions: BetSuggestion[] = [];\n  \n  const totalAvgGoals = analysis.homeTeam.avgGoalsScored + analysis.awayTeam.avgGoalsScored;\n  const defensiveStrength = (analysis.homeTeam.avgGoalsConceded + analysis.awayTeam.avgGoalsConceded) / 2;\n  const homeFormPoints = calculateFormPoints(analysis.homeTeam.form);\n  const awayFormPoints = calculateFormPoints(analysis.awayTeam.form);\n  \n  // ============================================\n  // CONSERVADOR - Apostas mais seguras (odds baixas, alta probabilidade)\n  // ============================================\n  \n  // Ambas Marcam - Conservador (apenas se MUITO provável)\n  const homeScoresRegularly = analysis.homeTeam.avgGoalsScored >= 1.2;\n  const awayScoresRegularly = analysis.awayTeam.avgGoalsScored >= 1.0;\n  const bothDefensesWeak = analysis.homeTeam.avgGoalsConceded >= 1.0 && analysis.awayTeam.avgGoalsConceded >= 1.0;\n  \n  if (homeScoresRegularly && awayScoresRegularly && bothDefensesWeak) {\n    const confidence = Math.min(85, Math.round(\n      ((analysis.homeTeam.avgGoalsScored + analysis.awayTeam.avgGoalsScored) / 2.5) * 100\n    ));\n    \n    suggestions.push({\n      id: `${analysis.fixtureId}-btts-conservative`,\n      fixtureId: analysis.fixtureId,\n      type: 'both_teams_score',\n      riskLevel: 'conservative',\n      description: 'Ambos Marcam',\n      odds: 1.60, // Odd conservadora\n      confidence: confidence,\n      reasoning: `${analysis.homeTeam.name} marca em média ${analysis.homeTeam.avgGoalsScored.toFixed(1)} gols e ${analysis.awayTeam.name} marca ${analysis.awayTeam.avgGoalsScored.toFixed(1)} gols por jogo. Ambas defesas concedem gols regularmente.`,\n      prediction: 'Sim',\n    });\n  } else if (defensiveStrength < 0.8 || totalAvgGoals < 1.8) {\n    // Se defesas muito fortes OU poucos gols\n    const confidence = Math.min(75, Math.round(\n      (1 - (totalAvgGoals / 3.0)) * 100\n    ));\n    \n    suggestions.push({\n      id: `${analysis.fixtureId}-btts-conservative`,\n      fixtureId: analysis.fixtureId,\n      type: 'both_teams_score',\n      riskLevel: 'conservative',\n      description: 'Ambos Marcam',\n      odds: 1.70,\n      confidence: confidence,\n      reasoning: `Defesas sólidas (média de ${defensiveStrength.toFixed(1)} gols sofridos). Pelo menos um time tende a não marcar.`,\n      prediction: 'Não',\n    });\n  }\n  \n  // Total de Gols - Conservador (baseado em média histórica)\n  if (totalAvgGoals >= 2.8 && defensiveStrength >= 1.3) {\n    // Muitos gols esperados\n    const confidence = Math.min(80, Math.round(\n      (totalAvgGoals / 3.5) * 100\n    ));\n    \n    suggestions.push({\n      id: `${analysis.fixtureId}-goals-conservative`,\n      fixtureId: analysis.fixtureId,\n      type: 'total_goals',\n      riskLevel: 'conservative',\n      description: 'Total de Gols',\n      odds: 1.65,\n      confidence: confidence,\n      reasoning: `Média combinada de ${totalAvgGoals.toFixed(1)} gols por jogo. Ambos ataques produtivos e defesas vulneráveis.`,\n      prediction: 'Mais de 2.5 gols',\n    });\n  } else if (totalAvgGoals <= 2.0 && defensiveStrength <= 1.0) {\n    // Poucos gols esperados\n    const confidence = Math.min(78, Math.round(\n      (1 - (totalAvgGoals / 3.0)) * 100\n    ));\n    \n    suggestions.push({\n      id: `${analysis.fixtureId}-goals-conservative`,\n      fixtureId: analysis.fixtureId,\n      type: 'total_goals',\n      riskLevel: 'conservative',\n      description: 'Total de Gols',\n      odds: 1.70,\n      confidence: confidence,\n      reasoning: `Média baixa de ${totalAvgGoals.toFixed(1)} gols por jogo. Defesas sólidas com média de ${defensiveStrength.toFixed(1)} gols sofridos.`,\n      prediction: 'Menos de 2.5 gols',\n    });\n  }\n  \n  // ============================================\n  // MÉDIO - Apostas com risco moderado (odds médias)\n  // ============================================\n  \n  // Vencedor da Partida - Médio (baseado em forma e histórico)\n  const formDifference = homeFormPoints - awayFormPoints;\n  \n  if (formDifference >= 4 && analysis.homeTeam.avgGoalsScored > analysis.awayTeam.avgGoalsScored) {\n    const confidence = Math.min(68, Math.round(\n      50 + (formDifference * 3)\n    ));\n    \n    suggestions.push({\n      id: `${analysis.fixtureId}-winner-medium`,\n      fixtureId: analysis.fixtureId,\n      type: 'match_winner',\n      riskLevel: 'medium',\n      description: 'Vencedor da Partida',\n      odds: 1.95,\n      confidence: confidence,\n      reasoning: `${analysis.homeTeam.name} em melhor forma (${analysis.homeTeam.form} vs ${analysis.awayTeam.form}). Vantagem de jogar em casa e melhor média de gols (${analysis.homeTeam.avgGoalsScored.toFixed(1)} vs ${analysis.awayTeam.avgGoalsScored.toFixed(1)}).`,\n      prediction: `Vitória ${analysis.homeTeam.name}`,\n    });\n  } else if (formDifference <= -4 && analysis.awayTeam.avgGoalsScored > analysis.homeTeam.avgGoalsScored) {\n    const confidence = Math.min(65, Math.round(\n      50 + (Math.abs(formDifference) * 2.5)\n    ));\n    \n    suggestions.push({\n      id: `${analysis.fixtureId}-winner-medium`,\n      fixtureId: analysis.fixtureId,\n      type: 'match_winner',\n      riskLevel: 'medium',\n      description: 'Vencedor da Partida',\n      odds: 2.40,\n      confidence: confidence,\n      reasoning: `${analysis.awayTeam.name} em melhor forma (${analysis.awayTeam.form} vs ${analysis.homeTeam.form}). Melhor média de gols (${analysis.awayTeam.avgGoalsScored.toFixed(1)} vs ${analysis.homeTeam.avgGoalsScored.toFixed(1)}).`,\n      prediction: `Vitória ${analysis.awayTeam.name}`,\n    });\n  } else if (Math.abs(formDifference) <= 2 && Math.abs(analysis.homeTeam.avgGoalsScored - analysis.awayTeam.avgGoalsScored) < 0.5) {\n    suggestions.push({\n      id: `${analysis.fixtureId}-winner-medium`,\n      fixtureId: analysis.fixtureId,\n      type: 'match_winner',\n      riskLevel: 'medium',\n      description: 'Vencedor da Partida',\n      odds: 3.20,\n      confidence: 55,\n      reasoning: `Times equilibrados em forma (${analysis.homeTeam.form} vs ${analysis.awayTeam.form}) e estatísticas similares. Histórico de confrontos diretos indica equilíbrio.`,\n      prediction: 'Empate',\n    });\n  }\n  \n  // Total de Gols - Médio (limites mais arriscados)\n  if (totalAvgGoals >= 3.2) {\n    const confidence = Math.min(65, Math.round(\n      (totalAvgGoals / 4.0) * 100\n    ));\n    \n    suggestions.push({\n      id: `${analysis.fixtureId}-goals-medium`,\n      fixtureId: analysis.fixtureId,\n      type: 'total_goals',\n      riskLevel: 'medium',\n      description: 'Total de Gols',\n      odds: 2.10,\n      confidence: confidence,\n      reasoning: `Média muito alta de ${totalAvgGoals.toFixed(1)} gols por jogo. Jogos recentes indicam confrontos abertos.`,\n      prediction: 'Mais de 3.5 gols',\n    });\n  } else if (totalAvgGoals <= 1.5) {\n    const confidence = Math.min(62, Math.round(\n      (1 - (totalAvgGoals / 2.5)) * 100\n    ));\n    \n    suggestions.push({\n      id: `${analysis.fixtureId}-goals-medium`,\n      fixtureId: analysis.fixtureId,\n      type: 'total_goals',\n      riskLevel: 'medium',\n      description: 'Total de Gols',\n      odds: 2.25,\n      confidence: confidence,\n      reasoning: `Média muito baixa de ${totalAvgGoals.toFixed(1)} gols. Ambos times com dificuldade ofensiva.`,\n      prediction: 'Menos de 1.5 gols',\n    });\n  }\n  \n  // ============================================\n  // ALTO RISCO - Apostas arriscadas (odds altas, menor probabilidade)\n  // ============================================\n  \n  // Placar Exato - Alto Risco\n  const predictedHomeGoals = Math.round(analysis.homeTeam.avgGoalsScored);\n  const predictedAwayGoals = Math.round(analysis.awayTeam.avgGoalsScored);\n  \n  // Limitar previsões a placares realistas (0-4 gols)\n  const homeGoals = Math.min(4, Math.max(0, predictedHomeGoals));\n  const awayGoals = Math.min(4, Math.max(0, predictedAwayGoals));\n  \n  const confidence = Math.min(45, Math.round(\n    30 + ((analysis.homeTeam.avgGoalsScored + analysis.awayTeam.avgGoalsScored) * 3)\n  ));\n  \n  suggestions.push({\n    id: `${analysis.fixtureId}-score-high`,\n    fixtureId: analysis.fixtureId,\n    type: 'correct_score',\n    riskLevel: 'high',\n    description: 'Placar Exato',\n    odds: 8.50,\n    confidence: confidence,\n    reasoning: `Baseado nas médias: ${analysis.homeTeam.name} marca ${analysis.homeTeam.avgGoalsScored.toFixed(1)} e ${analysis.awayTeam.name} marca ${analysis.awayTeam.avgGoalsScored.toFixed(1)} gols por jogo.`,\n    prediction: `${homeGoals}-${awayGoals}`,\n  });\n  \n  // Escanteios - Alto Risco (apenas se jogo ofensivo)\n  if (totalAvgGoals >= 2.5) {\n    const confidence = Math.min(50, Math.round(\n      (totalAvgGoals / 3.5) * 60\n    ));\n    \n    suggestions.push({\n      id: `${analysis.fixtureId}-corners-high`,\n      fixtureId: analysis.fixtureId,\n      type: 'corners',\n      riskLevel: 'high',\n      description: 'Total de Escanteios',\n      odds: 1.85,\n      confidence: confidence,\n      reasoning: `Jogos ofensivos (média de ${totalAvgGoals.toFixed(1)} gols) tendem a gerar mais escanteios. Times pressionam mais.`,\n      prediction: 'Mais de 9.5 escanteios',\n    });\n  }\n  \n  // Gols em ambos os tempos - Alto Risco\n  if (totalAvgGoals >= 2.8 && defensiveStrength >= 1.2) {\n    suggestions.push({\n      id: `${analysis.fixtureId}-halftime-high`,\n      fixtureId: analysis.fixtureId,\n      type: 'total_goals',\n      riskLevel: 'high',\n      description: 'Gols em Ambos os Tempos',\n      odds: 2.75,\n      confidence: 48,\n      reasoning: `Alta média de gols (${totalAvgGoals.toFixed(1)}) e defesas vulneráveis sugerem gols distribuídos ao longo da partida.`,\n      prediction: 'Sim',\n    });\n  }\n  \n  return suggestions;\n}\n\nfunction calculateFormPoints(form: string): number {\n  let points = 0;\n  for (const char of form) {\n    if (char === 'W' || char === 'V') points += 3;\n    else if (char === 'D' || char === 'E') points += 1;\n  }\n  return points;\n}\n\n// Salvar resultado no localStorage\nexport function savePredictionResult(result: PredictionResult) {\n  const results = getPredictionResults();\n  const existing = results.findIndex(r => r.fixtureId === result.fixtureId);\n  \n  if (existing >= 0) {\n    results[existing] = result;\n  } else {\n    results.push(result);\n  }\n  \n  // Manter apenas últimos 30 dias\n  const thirtyDaysAgo = new Date();\n  thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n  \n  const filtered = results.filter(r => new Date(r.date) >= thirtyDaysAgo);\n  \n  if (typeof window !== 'undefined') {\n    localStorage.setItem('bet-predictions', JSON.stringify(filtered));\n  }\n}\n\nexport function getPredictionResults(): PredictionResult[] {\n  if (typeof window === 'undefined') return [];\n  \n  const data = localStorage.getItem('bet-predictions');\n  return data ? JSON.parse(data) : [];\n}\n\nexport function calculateDashboardStats() {\n  const results = getPredictionResults();\n  const completed = results.filter(r => r.status === 'won' || r.status === 'lost');\n  \n  const total = completed.length;\n  const won = completed.filter(r => r.status === 'won').length;\n  const lost = completed.filter(r => r.status === 'lost').length;\n  const winRate = total > 0 ? (won / total) * 100 : 0;\n  \n  // Stats por nível de risco\n  const conservative = completed.filter(r => \n    r.suggestions.some(s => s.riskLevel === 'conservative')\n  );\n  const medium = completed.filter(r => \n    r.suggestions.some(s => s.riskLevel === 'medium')\n  );\n  const high = completed.filter(r => \n    r.suggestions.some(s => s.riskLevel === 'high')\n  );\n  \n  return {\n    total,\n    won,\n    lost,\n    winRate: winRate.toFixed(1),\n    byRisk: {\n      conservative: {\n        total: conservative.length,\n        won: conservative.filter(r => r.status === 'won').length,\n        rate: conservative.length > 0 \n          ? ((conservative.filter(r => r.status === 'won').length / conservative.length) * 100).toFixed(1)\n          : '0',\n      },\n      medium: {\n        total: medium.length,\n        won: medium.filter(r => r.status === 'won').length,\n        rate: medium.length > 0 \n          ? ((medium.filter(r => r.status === 'won').length / medium.length) * 100).toFixed(1)\n          : '0',\n      },\n      high: {\n        total: high.length,\n        won: high.filter(r => r.status === 'won').length,\n        rate: high.length > 0 \n          ? ((high.filter(r => r.status === 'won').length / high.length) * 100).toFixed(1)\n          : '0',\n      },\n    },\n  };\n}
